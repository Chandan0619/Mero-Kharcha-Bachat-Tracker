{% extends 'finance/base.html' %}

{% block content %}
<div class="stat-grid">
    <div class="card stat-card">
        <h4>Total Income</h4>
        <div class="stat-value" style="color: #27ae60;">Rs.{{ income_total }}</div>
    </div>
    <div class="card stat-card">
        <h4>Total Expenses</h4>
        <div class="stat-value" style="color: #c0392b;">Rs.{{ expense_total }}</div>
    </div>
    <div class="card stat-card">
        <h4>Net Savings</h4>
        <div class="stat-value {% if savings >= 0 %}text-primary{% else %}text-danger{% endif %}">Rs.{{ savings }}</div>
    </div>
    <div class="card stat-card">
        <h4>Accumulated Savings</h4>
        <div class="stat-value" style="color: #8e44ad;">Rs.{{ automated_savings }}</div>
    </div>
</div>

<div class="card">
    <h3>Quick Actions</h3>
    <div class="action-bar">
        <a href="{% url 'add_income' %}" class="btn">Add Income</a>
        <a href="{% url 'add_expense' %}" class="btn" style="background: #e74c3c;">Add Expense</a>
        <a href="{% url 'add_savings' %}" class="btn" style="background: #8e44ad;">Add Savings Goal</a>
        <a href="{% url 'add_budget' %}" class="btn" style="background: #f39c12;">Set Budget</a>
        <a href="{% url 'add_reminder' %}" class="btn" style="background: #2c3e50;">Add Reminder</a>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
    <div class="card">
        <h3>Recent Income</h3>
        <table>
            {% for item in recent_income %}
            <tr>
                <td>{{ item.source }}</td>
                <td>{{ item.date }}</td>
                <td style="color: #27ae60; font-weight: bold;">Rs.{{ item.amount }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="3" style="color: #aaa; text-align: center;">No recent income.</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    <div class="card">
        <h3>Recent Expenses</h3>
        <table>
            {% for item in recent_expenses %}
            <tr>
                <td>{{ item.category }}</td>
                <td>{{ item.date }}</td>
                <td style="color: #c0392b; font-weight: bold;">Rs.{{ item.amount }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="3" style="color: #aaa; text-align: center;">No recent expenses.</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>

<div class="card">
    <h3>Budgets</h3>
    <table>
        <thead>
            <tr>
                <th>Category</th>
                <th>Pocket</th>
                <th>Limit</th>
                <th>Spent</th>
                <th>Left</th>
            </tr>
        </thead>
        {% for budget in budgets %}
        <tr>
            <td>{{ budget.category }}</td>
            <td>
                {{ budget.period }}<br>
                <small style="color: #7f8c8d; font-size: 0.8em;">
                    {% if budget.start_date %}{{ budget.start_date|date:"M d" }} - {{ budget.end_date|date:"M d" }}
                    {% endif %}
                </small>
            </td>
            <td>Rs.{{ budget.limit }}</td>
            <td style="color: #c0392b;">Rs.{{ budget.spent }}</td>
            <td style="font-weight: bold; color: {% if budget.remaining < 0 %}#c0392b{% else %}#27ae60{% endif %};">
                Rs.{{ budget.remaining }}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="3" style="color: #aaa; text-align: center;">No budgets set.</td>
        </tr>
        {% endfor %}
    </table>
</div>

<div class="card">
    <h3>Savings Goals</h3>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Target</th>
                <th>Current</th>
                <th>Date</th>
            </tr>
        </thead>
        {% for goal in savings_goals %}
        <tr>
            <td>{{ goal.name }}</td>
            <td>${{ goal.target_amount }}</td>
            <td>${{ goal.current_amount }}</td>
            <td>{{ goal.target_date }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4" style="color: #aaa; text-align: center;">No savings goals.</td>
        </tr>
        {% endfor %}
    </table>
</div>

<div class="card">
    <h3>Reminders</h3>
    <ul>
        {% for reminder in reminders %}
        <li style="margin-bottom: 10px;">
            <strong>{{ reminder.title }}</strong>: {{ reminder.message }}
            <span style="color: #7f8c8d; font-size: 0.9em;">({{ reminder.reminder_date }})</span>
        </li>
        {% empty %}
        <li style="color: #aaa; list-style: none; text-align: center;">No active reminders.</li>
        {% endfor %}
    </ul>
</div>
{% endblock %}
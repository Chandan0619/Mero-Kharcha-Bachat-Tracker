{% extends 'finance/base.html' %}

{% block content %}
<style>
    /* Remove arrows/spinners from number input */
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* Firefox */
    input[type=number] {
        -moz-appearance: textfield;
    }
</style>
<div class="card" style="max-width: 600px; margin: auto;">
    <h2 style="border-bottom: 2px solid #f0f0f0; padding-bottom: 15px; margin-bottom: 20px;">{{ title }}</h2>
    <form method="post">
        {% csrf_token %}
        {% for field in form %}
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #555;">{{ field.label }}</label>
            {{ field }}
            {% if field.errors %}
            <div style="color: #c0392b; font-size: 0.85em; margin-top: 5px;">{{ field.errors }}</div>
            {% endif %}
            {% if field.help_text %}
            <div style="color: #95a5a6; font-size: 0.85em; margin-top: 5px;">{{ field.help_text }}</div>
            {% endif %}
        </div>
        {% endfor %}
        <div style="margin-top: 30px; display: flex; gap: 15px;">
            <button type="submit" class="btn" style="flex: 1;">Save</button>
            <a href="{% url 'dashboard' %}" class="btn btn-secondary" style="flex: 1; text-align: center;">Cancel</a>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Function to handle "Add New" toggle
        function setupNewCategoryToggle(selectId, inputName) {
            const selectElement = document.getElementById(selectId);
            // Note: inputName might be prefixed if using formsets, but here it's simple
            // We search for the input by name attribute
            const inputElement = document.querySelector(`input[name="${inputName}"]`);

            if (selectElement && inputElement) {
                const parentDiv = inputElement.closest('div'); // The wrapper div

                function toggle() {
                    if (selectElement.value === 'Add New') {
                        if (parentDiv) parentDiv.style.display = 'block';
                    } else {
                        if (parentDiv) parentDiv.style.display = 'none';
                    }
                }

                // Initial check
                toggle();

                // Change listener
                selectElement.addEventListener('change', toggle);
            }
        }

        // Apply to potential fields (Budget, Income, Expense)
        setupNewCategoryToggle('id_category', 'new_category');
        setupNewCategoryToggle('id_source', 'new_category');
        setupNewCategoryToggle('id_payment_method', 'new_payment_method');
    });
</script>
{% endblock %}